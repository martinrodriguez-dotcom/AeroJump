<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroJump Gualeguaych√∫ - Gesti√≥n Integral v2026</title>
    
    <!-- Frameworks y Fuentes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#7c3aed">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <style>
        :root {
            --color-violet: #7c3aed;
            --color-violet-hover: #6d28d9;
            --color-orange: #f97316;
            --color-slate: #1e293b;
            --bg-main: #f8fafc;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--color-slate); 
            overflow-x: hidden;
        }

        /* Estructura de Modales Estilo Ventana Extra */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            animation: modalFadeIn 0.3s ease-out;
        }
        .modal.is-open { display: flex; }

        .modal-content {
            background: white;
            width: 100%;
            max-height: 94vh;
            border-radius: 2.5rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header { padding: 1.5rem 2rem; border-bottom: 1px solid #f1f5f9; flex-shrink: 0; }
        .modal-body { padding: 1.5rem; overflow-y: auto; flex-grow: 1; }
        .modal-footer { padding: 1.5rem 2rem; border-top: 1px solid #f1f5f9; flex-shrink: 0; background: #ffffff; }

        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* Botones de Horario con Info de Ocupaci√≥n */
        .time-slot {
            padding: 0.8rem;
            border-radius: 1.25rem;
            border: 2px solid #e2e8f0;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            background: white;
        }
        .time-slot:hover:not(.disabled) { border-color: var(--color-violet); transform: translateY(-2px); }
        .time-slot.selected { background: var(--color-violet); border-color: var(--color-violet); color: white; box-shadow: 0 10px 15px -3px rgba(124, 58, 237, 0.3); }
        .time-slot.disabled { opacity: 0.3; cursor: not-allowed; background: #f1f5f9; border-style: dashed; }
        .time-slot .capacity-info { font-size: 0.6rem; font-weight: 800; text-transform: uppercase; margin-top: 2px; }

        /* Dise√±o de Tarjetas de Producto en Venta */
        .product-sale-card {
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 1.5rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .product-sale-card:hover {
            border-color: var(--color-violet);
            box-shadow: 0 10px 15px -3px rgba(124, 58, 237, 0.1);
            transform: translateY(-2px);
        }

        /* Calendario */
        .day-cell { border-radius: 1.25rem; transition: all 0.2s; border: 2px solid #fff; background: white; min-height: 100px; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .day-cell:hover { border-color: var(--color-violet); transform: scale(1.05); z-index: 10; box-shadow: 0 20px 25px -5px rgba(124, 58, 237, 0.1); }
        .booking-count { background: var(--color-violet); color: white; border-radius: 99px; padding: 2px 8px; font-size: 0.65rem; font-weight: 900; }
        .booking-count.event { background: var(--color-orange); }

        /* Navegaci√≥n */
        #main-menu {
            position: fixed; top: 0; left: 0; height: 100vh; width: 300px;
            background: white; transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 500; box-shadow: 20px 0 50px rgba(0,0,0,0.1);
        }
        #main-menu.is-open { transform: translateX(0); }

        /* Utilitarios */
        .is-hidden { display: none !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }

        /* Switch */
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--color-violet); }
        input:checked + .slider:before { transform: translateX(22px); }

        @keyframes jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-35px); } }
        .jumping-child { animation: jump 0.8s ease-in-out infinite; }
    </style>
</head>
<body>

    <!-- ============================================= -->
    <!-- 1. CAPA DE ACCESO (LOGIN)                    -->
    <!-- ============================================= -->
    <div id="login-view" class="view-container flex items-center justify-center min-h-screen p-4">
        <div class="bg-white p-10 rounded-[3.5rem] shadow-2xl w-full max-w-sm text-center">
            <div class="inline-block p-5 bg-violet-100 rounded-3xl mb-6"><span class="text-4xl">üöÄ</span></div>
            <h2 class="text-3xl font-black text-slate-800 tracking-tighter uppercase italic mb-2">AeroJump</h2>
            <p class="text-slate-400 font-bold text-[10px] uppercase tracking-widest mb-10 italic">Management System v2026</p>
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" placeholder="Email de Admin" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border-none focus:ring-4 focus:ring-violet-50 outline-none transition-all" required>
                <input type="password" id="login-password" placeholder="Contrase√±a" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border-none focus:ring-4 focus:ring-violet-50 outline-none transition-all" required>
                <button type="submit" class="bg-violet-600 text-white w-full py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all">Ingresar</button>
            </form>
            <a href="#" id="show-register" class="block mt-8 text-[10px] text-violet-600 font-black uppercase italic hover:underline">Solicitar alta de administrador</a>
        </div>
    </div>

    <div id="register-view" class="view-container flex items-center justify-center min-h-screen p-4 is-hidden">
        <div class="bg-white p-10 rounded-[3.5rem] shadow-2xl w-full max-w-sm text-center">
            <h2 class="text-3xl font-black text-slate-800 tracking-tighter uppercase italic mb-8">Nueva Cuenta</h2>
            <form id="register-form" class="space-y-4">
                <input type="email" id="register-email" placeholder="Email" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border focus:ring-4 focus:ring-violet-50" required>
                <input type="password" id="register-password" placeholder="M√≠nimo 6 caracteres" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border focus:ring-4 focus:ring-violet-50" required>
                <button type="submit" class="bg-violet-600 text-white w-full py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all">Registrar Admin</button>
            </form>
            <a href="#" id="show-login" class="block mt-8 text-[11px] text-violet-600 font-black uppercase italic">Volver al Login</a>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- 2. CONTENEDOR PRINCIPAL                      -->
    <!-- ============================================= -->
    <div id="app-container" class="is-hidden">
        
        <header class="fixed top-0 left-0 right-0 bg-white/90 backdrop-blur-md shadow-sm p-4 flex justify-between items-center z-50 border-b">
            <div class="flex items-center gap-3">
                <button id="menu-btn" class="p-3 rounded-2xl bg-slate-50 hover:bg-slate-100 transition-all active:scale-90 shadow-sm border">
                    <svg class="h-6 w-6 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path d="M4 6h16M4 12h16M4 18h16" /></svg>
                </button>
                <div class="leading-none text-left">
                    <h1 class="text-xl font-black text-slate-800 uppercase italic tracking-tighter">AeroJump</h1>
                    <span class="text-[8px] font-black text-violet-500 uppercase tracking-widest">v2026 Admin</span>
                </div>
            </div>
            <button id="header-sale-btn" class="bg-orange-500 text-white px-6 py-3 rounded-2xl font-black shadow-lg uppercase text-[10px] active:scale-90 transition-all hover:bg-orange-600">Venta Kiosco</button>
        </header>

        <nav id="main-menu" class="p-8 flex flex-col">
            <div class="border-b border-slate-100 pb-6 mb-8 text-left">
                <p id="user-email-display" class="font-black text-violet-700 truncate text-xs italic mb-2 leading-none"></p>
                <button id="logout-btn" class="text-[10px] font-black text-slate-400 uppercase hover:text-red-500 transition-colors">Cerrar Sesi√≥n</button>
            </div>
            <div class="space-y-2">
                <button class="menu-item flex items-center gap-4 w-full text-left p-4 rounded-2xl font-black text-slate-600 hover:bg-violet-50 hover:text-violet-700 transition-all text-xs uppercase italic" data-view="calendar"><span>üóìÔ∏è</span> Agenda Saltos</button>
                <button class="menu-item flex items-center gap-4 w-full text-left p-4 rounded-2xl font-black text-slate-600 hover:bg-violet-50 hover:text-violet-700 transition-all text-xs uppercase italic" data-view="productos"><span>ü•§</span> Stock Kiosco</button>
                <button class="menu-item flex items-center gap-4 w-full text-left p-4 rounded-2xl font-black text-slate-600 hover:bg-violet-50 hover:text-violet-700 transition-all text-xs uppercase italic" data-view="caja"><span>üí∞</span> Arqueo de Caja</button>
                <button class="menu-item flex items-center gap-4 w-full text-left p-4 rounded-2xl font-black text-slate-600 hover:bg-violet-50 hover:text-violet-700 transition-all text-xs uppercase italic" data-view="stats"><span>üìä</span> Estad√≠sticas</button>
                <button class="menu-item flex items-center gap-4 w-full text-left p-4 rounded-2xl font-black text-slate-600 hover:bg-violet-50 hover:text-violet-700 transition-all text-xs uppercase italic" data-view="configuracion"><span>‚öôÔ∏è</span> Configuraci√≥n</button>
            </div>
        </nav>
        <div id="menu-overlay" class="fixed inset-0 bg-slate-900/50 z-40 hidden"></div>

        <main class="pt-28 pb-12 px-4 max-w-6xl mx-auto">
            
            <!-- VISTA: CALENDARIO -->
            <div id="calendar-view" class="view-container">
                <div class="flex justify-between items-center bg-white p-6 rounded-[2.5rem] shadow-xl mb-8 border relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-10 opacity-5 text-7xl font-black italic select-none">AGENDA</div>
                    <button id="prev-month-btn" class="p-3 text-slate-300 font-black hover:text-violet-600 transition-colors text-2xl">‚óÄ</button>
                    <h2 id="current-month-year" class="text-2xl font-black text-violet-700 uppercase italic tracking-tighter text-center"></h2>
                    <button id="next-month-btn" class="p-3 text-slate-300 font-black hover:text-violet-600 transition-colors text-2xl">‚ñ∂</button>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 gap-4"></div>
            </div>

            <!-- VISTA: PRODUCTOS -->
            <div id="productos-view" class="view-container is-hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 text-left gap-6">
                    <div>
                        <h2 class="text-4xl font-black italic uppercase text-slate-800 leading-none">Inventario</h2>
                        <p class="text-slate-400 font-bold text-[10px] uppercase mt-2 italic">Gesti√≥n de Kiosco AeroJump</p>
                    </div>
                    <button id="add-product-btn" class="bg-violet-600 text-white px-10 py-5 rounded-[1.5rem] font-black shadow-xl text-[11px] active:scale-95 transition-all">+ NUEVO ART√çCULO</button>
                </div>
                
                <!-- Formulario Producto -->
                <div id="product-form-container" class="bg-white p-10 rounded-[3rem] shadow-2xl mb-12 is-hidden border-4 border-violet-50 text-left relative overflow-hidden text-sm">
                    <h3 class="text-2xl font-black text-violet-900 mb-8 uppercase italic tracking-tighter">‚ú® Registro de Mercader√≠a</h3>
                    <form id="product-form" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-2">
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic">Nombre del Producto</label>
                            <input type="text" id="prod-name" placeholder="Ej: Bebida 500ml" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border focus:ring-4 focus:ring-violet-50 outline-none transition-all" required>
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic">Stock Inicial</label>
                            <input type="number" id="prod-stock" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border focus:ring-4 focus:ring-violet-50 outline-none text-center" required min="0">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic">Costo de Bulto ($)</label>
                            <input type="number" id="prod-batch-cost" class="w-full p-5 bg-violet-50 rounded-2xl font-black text-xl text-violet-700 border outline-none" required step="0.01">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic">Unidades por Bulto</label>
                            <input type="number" id="prod-batch-qty" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border outline-none text-center" required min="1" value="1">
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic">Margen (%)</label>
                            <input type="number" id="prod-profit-pct" class="w-full p-5 bg-orange-50 rounded-2xl font-bold border outline-none text-center" value="40">
                        </div>
                        <div class="md:col-span-3 p-8 bg-slate-900 rounded-[2.5rem] flex flex-col md:flex-row justify-between items-center gap-8 shadow-2xl">
                            <div class="text-left">
                                <span class="text-[10px] font-black text-green-400 uppercase block mb-1 italic tracking-widest">Precio de Venta Sugerido</span>
                                <span id="prod-suggested-price" class="text-6xl font-black text-white italic tracking-tighter">$0</span>
                            </div>
                            <div class="flex gap-4 w-full md:w-auto">
                                <button type="button" id="cancel-product-btn" class="flex-1 px-8 py-5 text-slate-400 font-black uppercase text-xs">Descartar</button>
                                <button type="submit" class="flex-2 bg-green-600 text-white px-14 py-6 rounded-2xl font-black uppercase text-xs shadow-xl active:scale-95 transition-all border-b-8 border-green-900">Confirmar Alta</button>
                            </div>
                        </div>
                        <input type="hidden" id="prod-unit-cost">
                    </form>
                </div>
                <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </div>

            <!-- VISTA: CAJA -->
            <div id="caja-view" class="view-container is-hidden">
                <h2 class="text-5xl font-black mb-12 text-center uppercase italic text-slate-800 tracking-tighter">Arqueo Diario</h2>
                <div class="bg-slate-900 p-12 rounded-[4rem] text-white mb-10 shadow-2xl text-center relative overflow-hidden border-t-[12px] border-violet-500">
                    <p class="text-[10px] font-black text-violet-400 uppercase mb-2 tracking-[0.4em] italic leading-none">Cierre de Caja Total AeroJump</p>
                    <p id="caja-total-combined" class="text-8xl font-black italic tracking-tighter text-white leading-none">$0</p>
                </div>
                <div id="caja-daily-list" class="space-y-4 text-left"></div>
            </div>

            <!-- VISTA: CONFIGURACI√ìN -->
            <div id="configuracion-view" class="view-container is-hidden max-w-md mx-auto">
                <div class="bg-white p-12 rounded-[4rem] shadow-2xl border-4 border-slate-50 text-left">
                    <h2 class="text-3xl font-black mb-10 uppercase italic text-center text-slate-800 tracking-tighter">Tarifario Maestro</h2>
                    <form id="config-form" class="space-y-8">
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 ml-2 italic tracking-widest text-left">Costo Salto 1 Hora ($)</label>
                            <input type="number" id="config-court1-price" class="w-full p-6 bg-slate-50 rounded-3xl font-black text-3xl text-violet-700 outline-none border focus:ring-8 focus:ring-violet-50 transition-all">
                        </div>
                        <button type="submit" class="w-full bg-slate-900 text-white py-6 rounded-[2.5rem] font-black uppercase italic border-b-8 border-black active:scale-95 transition-all shadow-2xl">Actualizar Valores</button>
                    </form>
                </div>
            </div>

            <!-- VISTA: ESTAD√çSTICAS -->
            <div id="stats-view" class="view-container is-hidden text-left">
                <h2 class="text-5xl font-black mb-12 uppercase italic text-slate-800 tracking-tighter leading-none">Rankings Pro</h2>
                <div id="stats-list" class="space-y-4"></div>
            </div>
        </main>
    </div>

    <!-- ============================================= -->
    <!-- SISTEMA DE MODALES (VENTANAS EXTRA)         -->
    <!-- ============================================= -->

    <!-- MODAL RESERVA -->
    <div id="booking-modal" class="modal">
        <div class="modal-content max-w-3xl">
            <div class="modal-header text-left bg-slate-50">
                <h3 id="booking-modal-title" class="text-3xl font-black text-violet-900 uppercase italic tracking-tighter leading-none">Reservar Salto</h3>
                <p class="text-[9px] text-slate-400 font-bold uppercase mt-1 tracking-widest">Gesti√≥n de cupos por hora</p>
            </div>
            <form id="booking-form" class="flex flex-col overflow-hidden text-left">
                <div class="modal-body custom-scrollbar bg-white">
                    <input type="hidden" id="booking-id"><input type="hidden" id="booking-date">
                    <div class="space-y-10">
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-2 italic tracking-widest">Responsable / Nombre del Cliente</label>
                            <input type="text" id="teamName" class="w-full p-7 bg-slate-50 rounded-[2.5rem] font-black text-3xl italic outline-none focus:ring-8 focus:ring-violet-50 border transition-all" required placeholder="Nombre Completo..." autocomplete="off">
                            <div id="teamName-suggestions" class="absolute z-50 bg-white shadow-2xl rounded-3xl is-hidden w-full max-w-md border overflow-hidden mt-2"></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="p-8 bg-slate-50 rounded-[3rem] border text-center relative overflow-hidden">
                                <label class="text-[10px] font-black uppercase text-slate-400 block mb-3 italic tracking-widest">Cantidad de Saltadores</label>
                                <div class="flex items-center justify-center gap-8">
                                    <button type="button" onclick="window.adjustJumpers(-1)" class="w-16 h-16 bg-white rounded-2xl font-black shadow-lg text-2xl active:scale-90 transition-all">-</button>
                                    <input type="number" id="peopleCount" class="w-24 text-center font-black text-5xl bg-transparent outline-none italic leading-none" value="1" min="1" max="30">
                                    <button type="button" onclick="window.adjustJumpers(1)" class="w-16 h-16 bg-white rounded-2xl font-black shadow-lg text-2xl active:scale-90 transition-all">+</button>
                                </div>
                            </div>
                            <div class="p-8 bg-violet-50 rounded-[3rem] border border-violet-100 flex flex-col justify-center text-center">
                                <span class="text-[10px] font-black text-violet-400 uppercase mb-1 italic tracking-widest">Costo Base Unitario</span>
                                <input type="number" id="costPerHour" class="bg-transparent font-black text-5xl text-violet-700 outline-none italic text-center leading-none">
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-black uppercase text-slate-400 ml-4 block mb-4 italic tracking-widest">Cupos Disponibles (M√°x. 30)</label>
                            <div id="court-hours-list" class="grid grid-cols-3 sm:grid-cols-5 gap-4"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex flex-col sm:flex-row justify-between items-center gap-8 bg-slate-50">
                    <div class="text-left leading-none">
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 italic">Total del Turno</span>
                        <p id="booking-total" class="text-6xl font-black text-violet-700 italic tracking-tighter leading-none">$0</p>
                    </div>
                    <div class="flex gap-4 w-full sm:w-auto">
                        <button type="button" onclick="window.closeModals()" class="flex-1 px-8 py-6 font-black text-slate-400 uppercase text-[10px] tracking-widest">Cancelar</button>
                        <button type="submit" class="flex-2 bg-violet-600 text-white px-16 py-6 rounded-[2.5rem] font-black uppercase shadow-2xl active:scale-95 transition-all text-xs border-b-8 border-violet-900 italic tracking-widest">Confirmar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL VENTAS REDISE√ëADO (NUEVO VISUAL) -->
    <div id="sale-modal" class="modal">
        <div class="modal-content max-w-5xl">
            <div class="modal-header flex justify-between items-center text-left bg-slate-900 text-white border-none p-8">
                <div>
                    <h3 class="text-4xl font-black text-orange-400 uppercase italic tracking-tighter leading-none">Punto de Venta</h3>
                    <p class="text-[10px] text-slate-400 font-bold uppercase mt-1 tracking-[0.3em] italic">Cat√°logo Kiosco AeroJump</p>
                </div>
                <button onclick="window.closeModals()" class="p-3 text-slate-500 hover:text-white transition-all">
                    <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div class="bg-white border-b px-10 py-6">
                <input type="text" id="sale-catalog-filter" class="w-full p-6 bg-slate-50 rounded-[2.5rem] font-black text-xl border-2 border-slate-100 outline-none focus:border-violet-500 shadow-inner italic transition-all placeholder:text-slate-300" placeholder="üîç Buscar producto en el cat√°logo...">
            </div>

            <!-- Grilla Visual de Productos -->
            <div class="modal-body custom-scrollbar bg-slate-50 p-8">
                <div id="sale-catalog-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Los productos se inyectan como tarjetas visuales -->
                </div>
            </div>
            
            <div class="modal-footer bg-slate-900 text-white p-10">
                <div class="flex flex-col lg:flex-row justify-between items-center w-full gap-10">
                    <!-- Medio de Pago Visual -->
                    <div class="flex flex-col gap-5 w-full lg:w-auto text-left">
                        <label class="text-[10px] font-black uppercase tracking-[0.3em] text-violet-400 italic">Medio de Pago</label>
                        <div class="flex gap-6">
                            <label class="flex-1 lg:w-48 flex items-center justify-center gap-4 bg-slate-800 p-5 rounded-3xl border-2 border-transparent has-[:checked]:border-orange-500 has-[:checked]:bg-slate-700 transition-all cursor-pointer group">
                                <input type="radio" name="salePaymentMethod" value="efectivo" class="hidden" checked>
                                <span class="font-black text-xs uppercase tracking-widest italic group-hover:text-orange-400">Efectivo üíµ</span>
                            </label>
                            <label class="flex-1 lg:w-48 flex items-center justify-center gap-4 bg-slate-800 p-5 rounded-3xl border-2 border-transparent has-[:checked]:border-violet-500 has-[:checked]:bg-slate-700 transition-all cursor-pointer group">
                                <input type="radio" name="salePaymentMethod" value="mercadopago" class="hidden">
                                <span class="font-black text-xs uppercase tracking-widest italic group-hover:text-violet-400">M.Pago üì±</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="text-right flex flex-col items-center lg:items-end leading-none">
                        <span class="text-[11px] font-black text-violet-400 uppercase tracking-widest block mb-2 italic">Total AeroJump</span>
                        <span id="sale-total-display" class="text-8xl font-black italic tracking-tighter text-white leading-none">$0</span>
                    </div>
                    
                    <button id="confirm-sale-btn" class="w-full lg:w-72 bg-orange-500 text-white py-8 rounded-[2.5rem] font-black uppercase shadow-2xl disabled:opacity-10 transition-all active:scale-95 italic text-sm border-b-8 border-orange-700" disabled>Cobrar Ahora</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL OPCIONES D√çA -->
    <div id="options-modal" class="modal">
        <div class="modal-content max-w-sm p-10 text-center border-4 border-violet-50 relative overflow-hidden">
            <h3 class="text-3xl font-black mb-10 text-slate-800 uppercase italic leading-none tracking-tighter">Turnos del D√≠a</h3>
            <div id="daily-bookings-list" class="space-y-3 mb-10 text-left custom-scrollbar max-h-72 overflow-y-auto italic pr-2 leading-none"></div>
            <button id="add-new-booking-btn" class="w-full bg-violet-600 text-white py-6 rounded-2xl font-black shadow-xl uppercase text-[10px] active:scale-95 border-b-8 border-violet-950 italic">+ AGREGAR TURNO</button>
            <button onclick="window.closeModals()" class="mt-6 text-slate-300 font-black uppercase text-[10px] tracking-widest hover:text-slate-600 transition-colors italic">Cerrar</button>
        </div>
    </div>

    <!-- OVERLAY CARGA -->
    <div id="message-overlay" class="modal bg-white/95 backdrop-blur-md">
        <div class="flex flex-col items-center justify-center min-h-screen text-center p-10">
            <svg width="140" height="140" viewBox="0 0 100 100" class="mb-10">
                <path d="M10 80 Q 50 80 90 80" stroke="#7c3aed" stroke-width="10" fill="none" stroke-linecap="round" class="trampoline-line"/>
                <g class="jumping-child"><circle cx="50" cy="30" r="12" fill="#f97316"/><line x1="50" y1="42" x2="50" y2="70" stroke="#1e293b" stroke-width="6" stroke-linecap="round"/></g>
            </svg>
            <p id="message-text" class="text-3xl font-black text-slate-800 uppercase italic tracking-tighter leading-none"></p>
        </div>
    </div>

    <!-- ============================================= -->
    <!-- L√ìGICA DE LA APLICACI√ìN (FIREBASE v11)       -->
    <!-- ============================================= -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, updateDoc, deleteDoc, collection, query, where, onSnapshot, getDocs, Timestamp, orderBy, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBz0V2ieSXehafKWRNQprb951NVN5FvBD4",
            authDomain: "aerojump-841fb.firebaseapp.com",
            projectId: "aerojump-841fb",
            storageBucket: "aerojump-841fb.firebasestorage.app",
            messagingSenderId: "68080726646",
            appId: "1:68080726646:web:a830613a1278871d416557"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appIdGlobal = "aerojump-gualeguaychu";

        const getPublicCollection = (name) => collection(db, 'artifacts', appIdGlobal, 'public', 'data', name);
        const getPublicDoc = (name, id) => doc(db, 'artifacts', appIdGlobal, 'public', 'data', name, id);

        // ESTADO GLOBAL
        let user = null;
        let allMonthBookings = [];
        let allProducts = [];
        let cartItems = {}; 
        let appSettings = { court1Price: 5000 };
        const MAX_CAPACITY = 30;
        const OPERATING_HOURS = [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23];
        const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        let currentMonthDate = new Date();

        // ELEMENTOS DOM
        const calendarGrid = document.getElementById('calendar-grid');
        const currentMonthYearEl = document.getElementById('current-month-year');
        const courtHoursList = document.getElementById('court-hours-list');

        // --- AUTH CONTROL ---
        onAuthStateChanged(auth, async (u) => {
            if (u) {
                user = u;
                document.getElementById('user-email-display').textContent = u.email;
                document.getElementById('login-view').classList.add('is-hidden');
                document.getElementById('register-view').classList.add('is-hidden');
                document.getElementById('app-container').classList.remove('is-hidden');
                setupAppListeners();
                await initApp();
            } else {
                document.getElementById('login-view').classList.remove('is-hidden');
                document.getElementById('app-container').classList.add('is-hidden');
            }
        });

        async function initApp() {
            await loadSettings();
            syncBookings();
            syncProducts();
        }

        // --- CONFIGURACI√ìN DE NAVEGACI√ìN Y BOTONES ---
        function setupAppListeners() {
            // Men√∫ Hamburguesa
            document.getElementById('menu-btn').onclick = () => {
                document.getElementById('main-menu').classList.toggle('is-open');
                document.getElementById('menu-overlay').classList.toggle('hidden');
            };
            document.getElementById('menu-overlay').onclick = () => {
                document.getElementById('main-menu').classList.remove('is-open');
                document.getElementById('menu-overlay').classList.add('hidden');
            };

            // Bot√≥n Venta Header
            document.getElementById('header-sale-btn').onclick = () => {
                cartItems = {};
                document.getElementById('sale-catalog-filter').value = '';
                renderSaleCatalog();
                document.getElementById('sale-modal').classList.add('is-open');
            };

            // Botones del Men√∫ Lateral (Navegaci√≥n entre vistas)
            document.querySelectorAll('.menu-item').forEach(btn => {
                btn.onclick = (e) => {
                    const targetView = e.currentTarget.dataset.view;
                    document.querySelectorAll('.view-container').forEach(v => v.classList.add('is-hidden'));
                    document.getElementById(`${targetView}-view`).classList.remove('is-hidden');
                    
                    // Cargar datos espec√≠ficos si es necesario
                    if(targetView === 'caja') loadCajaData();
                    
                    // Cerrar el men√∫
                    document.getElementById('main-menu').classList.remove('is-open');
                    document.getElementById('menu-overlay').classList.add('hidden');
                };
            });
        }

        // --- L√ìGICA DE OCUPACI√ìN ---
        function getOccupancyForDay(dateStr) {
            const occupancy = {};
            OPERATING_HOURS.forEach(h => occupancy[h] = 0);
            allMonthBookings.filter(b => b.day === dateStr).forEach(b => {
                const count = parseInt(b.peopleCount) || 0;
                b.courtHours.forEach(h => { if (occupancy[h] !== undefined) occupancy[h] += count; });
            });
            return occupancy;
        }

        function renderTimeSlots(dateStr, editingId = null) {
            const occupancy = getOccupancyForDay(dateStr);
            const currentBooking = allMonthBookings.find(b => b.id === editingId);
            const selectedHours = currentBooking ? currentBooking.courtHours : [];
            if (currentBooking) {
                const myCount = parseInt(currentBooking.peopleCount) || 0;
                selectedHours.forEach(h => occupancy[h] -= myCount);
            }
            if(!courtHoursList) return;
            courtHoursList.innerHTML = '';
            OPERATING_HOURS.forEach(h => {
                const available = MAX_CAPACITY - occupancy[h];
                const isFull = available <= 0;
                const btn = document.createElement('button');
                btn.type = "button";
                btn.className = `time-slot ${isFull ? 'disabled' : ''} ${selectedHours.includes(h) ? 'selected' : ''}`;
                btn.innerHTML = `<span class="font-black text-lg">${h}:00</span><span class="capacity-info ${available < 5 ? 'text-red-600' : 'text-slate-400'}">${available} libres</span>`;
                if (!isFull) { btn.onclick = () => { btn.classList.toggle('selected'); updateBookingPrice(); }; }
                courtHoursList.appendChild(btn);
            });
        }

        // --- CATALOGO VENTA (REDise√±ado Visual) ---
        function renderSaleCatalog(filter = "") {
            const container = document.getElementById('sale-catalog-grid');
            if(!container) return;
            container.innerHTML = '';
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
            
            filtered.forEach(p => {
                const qty = cartItems[p.id] || 0;
                const card = document.createElement('div');
                card.className = 'product-sale-card';
                card.innerHTML = `
                    <div class="text-left mb-4 leading-none">
                        <p class="font-black text-sm uppercase text-slate-800 leading-tight mb-2">${p.name}</p>
                        <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest leading-none">Disp: ${p.stock} un.</p>
                    </div>
                    <div class="flex justify-between items-center">
                        <strong class="text-3xl font-black text-violet-700 italic">$${p.salePrice}</strong>
                        <div class="flex items-center gap-2 bg-slate-50 p-1 rounded-2xl shadow-inner border border-slate-100">
                            <button onclick="window.updateCatalogQty('${p.id}', -1)" class="w-10 h-10 bg-white rounded-xl shadow-sm font-black text-slate-400 hover:text-red-500 transition-all">-</button>
                            <span class="w-8 text-center font-black text-xl italic ${qty > 0 ? 'text-violet-600' : 'text-slate-300'}">${qty}</span>
                            <button onclick="window.updateCatalogQty('${p.id}', 1)" class="w-10 h-10 bg-white rounded-xl shadow-sm font-black text-slate-400 hover:text-green-500 transition-all" ${qty >= p.stock ? 'disabled' : ''}>+</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
            updateSaleTotal();
        }

        window.updateCatalogQty = (id, delta) => {
            const p = allProducts.find(x => x.id === id);
            if(!p) return;
            let current = cartItems[id] || 0;
            current += delta;
            if (current <= 0) delete cartItems[id];
            else if (current > p.stock) current = p.stock;
            else cartItems[id] = current;
            renderSaleCatalog(document.getElementById('sale-catalog-filter').value);
        };

        function updateSaleTotal() {
            let total = 0;
            Object.keys(cartItems).forEach(id => {
                const p = allProducts.find(x => x.id === id);
                if(p) total += (p.salePrice * cartItems[id]);
            });
            document.getElementById('sale-total-display').textContent = `$${total.toLocaleString()}`;
            document.getElementById('confirm-sale-btn').disabled = total <= 0;
            const emptyMsg = document.getElementById('empty-cart-msg');
            if(emptyMsg) emptyMsg.classList.toggle('is-hidden', Object.keys(cartItems).length > 0);
        }

        // --- CRUD VENTA ---
        document.getElementById('confirm-sale-btn').onclick = async () => {
            const btn = document.getElementById('confirm-sale-btn');
            const method = document.querySelector('input[name="salePaymentMethod"]:checked').value;
            btn.disabled = true;
            try {
                const batch = writeBatch(db);
                const hoy = new Date().toISOString().split('T')[0];
                for (const id of Object.keys(cartItems)) {
                    const p = allProducts.find(x => x.id === id);
                    const qty = cartItems[id];
                    batch.set(doc(collection(db, "sales")), {
                        name: p.name, qty, total: p.salePrice * qty, paymentMethod: method,
                        day: hoy, monthYear: hoy.substring(0, 7), timestamp: Timestamp.now(), adminEmail: user.email
                    });
                    batch.update(getPublicDoc("products", id), { stock: p.stock - qty });
                }
                await batch.commit();
                showMessage("Venta finalizada!");
                setTimeout(() => { hideMessage(); window.closeModals(); }, 1500);
            } catch (err) { alert(err.message); btn.disabled = false; }
        };

        // --- L√ìGICA CALENDARIO ---
        function syncBookings() {
            const monthYear = `${currentMonthDate.getFullYear()}-${String(currentMonthDate.getMonth() + 1).padStart(2, '0')}`;
            onSnapshot(query(getPublicCollection("bookings"), where("monthYear", "==", monthYear)), (snap) => {
                allMonthBookings = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderCalendar();
            });
        }

        function renderCalendar() {
            if(!calendarGrid) return;
            calendarGrid.innerHTML = '';
            currentMonthYearEl.textContent = `${monthNames[currentMonthDate.getMonth()]} ${currentMonthDate.getFullYear()}`;
            const firstDay = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth(), 1).getDay();
            const lastDate = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth() + 1, 0).getDate();
            for (let i = 0; i < firstDay; i++) { calendarGrid.appendChild(document.createElement('div')); }
            for (let i = 1; i <= lastDate; i++) {
                const ds = `${currentMonthDate.getFullYear()}-${String(currentMonthDate.getMonth() + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                const bks = allMonthBookings.filter(b => b.day === ds);
                const cell = document.createElement('div');
                cell.className = 'day-cell p-4 flex flex-col justify-between text-left';
                cell.innerHTML = `<span class="font-black italic text-slate-800 text-xl">${i}</span>`;
                if (bks.length > 0) {
                    const badge = document.createElement('div');
                    badge.className = `booking-count ${bks.some(b => b.type === 'event') ? 'event' : ''} mt-1`;
                    badge.textContent = bks.length;
                    cell.appendChild(badge);
                }
                cell.onclick = () => { if(bks.length > 0) showOptionsModal(ds, bks); else showBookingModal(ds); };
                calendarGrid.appendChild(cell);
            }
        }

        function showOptionsModal(ds, bks) {
            const list = document.getElementById('daily-bookings-list');
            list.innerHTML = '';
            bks.forEach(b => {
                const it = document.createElement('div');
                it.className = 'p-5 bg-slate-50 rounded-3xl mb-3 flex justify-between items-center border border-slate-100 shadow-sm transition-all hover:bg-white';
                it.innerHTML = `<div><p class="font-black text-sm uppercase leading-none mb-2">${b.teamName}</p><p class="text-[9px] font-bold text-slate-400 italic">${b.courtHours.join(', ')}hs</p></div>`;
                const del = document.createElement('button');
                del.className = 'bg-orange-100 text-orange-600 p-3 rounded-2xl font-black text-[10px] uppercase hover:bg-orange-500 hover:text-white transition-all';
                del.textContent = 'Baja';
                del.onclick = async () => { if(confirm("¬øAnular este turno?")) { await deleteDoc(getPublicDoc("bookings", b.id)); window.closeModals(); } };
                it.appendChild(del);
                list.appendChild(it);
            });
            document.getElementById('add-new-booking-btn').onclick = () => { window.closeModals(); showBookingModal(ds); };
            document.getElementById('options-modal').classList.add('is-open');
        }

        // --- PRODUCTOS ---
        function syncProducts() {
            onSnapshot(getPublicCollection("products"), (snap) => {
                allProducts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                renderInventory();
                if(document.getElementById('sale-modal').classList.contains('is-open')) renderSaleCatalog();
            });
        }

        function renderInventory() {
            const list = document.getElementById('product-list');
            if(!list) return;
            list.innerHTML = '';
            allProducts.forEach(p => {
                const card = document.createElement('div');
                card.className = 'bg-white p-8 rounded-[3rem] shadow-xl border flex flex-col gap-6 text-left relative overflow-hidden group';
                card.innerHTML = `
                    <div class="absolute top-0 right-0 p-6 opacity-5 text-4xl font-black italic">AERO</div>
                    <div class="flex justify-between items-start leading-none relative z-10">
                        <div><h4 class="font-black italic uppercase text-slate-800 text-xl mb-2">${p.name}</h4><span class="text-[9px] font-black uppercase text-violet-500 bg-violet-50 px-2 py-1 rounded-lg">Stock: ${p.stock} un.</span></div>
                        <strong class="text-4xl font-black text-violet-600 italic tracking-tighter leading-none">$${p.salePrice}</strong>
                    </div>
                    <div class="flex gap-4 relative z-10">
                        <button onclick="window.deleteProduct('${p.id}')" class="flex-1 bg-orange-50 text-orange-500 py-4 rounded-2xl font-black text-[10px] uppercase hover:bg-orange-500 hover:text-white transition-all">Eliminar Producto</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        // --- SETTINGS & HELPERS ---
        async function loadSettings() {
            try {
                const d = await getDoc(getPublicDoc("app_settings", "prices"));
                if (d.exists()) { appSettings = d.data(); if(document.getElementById('config-court1-price')) document.getElementById('config-court1-price').value = appSettings.court1Price; }
            } catch(e) {}
        }

        window.closeModals = () => { document.querySelectorAll('.modal').forEach(m => m.classList.remove('is-open')); };
        window.adjustJumpers = (val) => {
            const input = document.getElementById('peopleCount');
            let n = parseInt(input.value) + val;
            if (n < 1) n = 1; if (n > 30) n = 30;
            input.value = n;
            renderTimeSlots(document.getElementById('booking-date').value, document.getElementById('booking-id').value);
            updateBookingPrice();
        };

        window.prevMonth = () => { currentMonthDate.setMonth(currentMonthDate.getMonth() - 1); syncBookings(); };
        window.nextMonth = () => { currentMonthDate.setMonth(currentMonthDate.getMonth() + 1); syncBookings(); };

        document.getElementById('booking-form').onsubmit = async (e) => {
            e.preventDefault();
            const selected = Array.from(document.getElementById('court-hours-list').querySelectorAll('.time-slot.selected')).map(el => parseInt(el.querySelector('span').textContent));
            if (selected.length === 0) return alert("Selecciona al menos un horario");
            const data = {
                teamName: document.getElementById('teamName').value.trim(),
                day: document.getElementById('booking-date').value,
                monthYear: document.getElementById('booking-date').value.substring(0, 7),
                peopleCount: parseInt(document.getElementById('peopleCount').value),
                costPerHour: parseFloat(document.getElementById('costPerHour').value),
                courtHours: selected,
                totalPrice: parseFloat(document.getElementById('booking-total').textContent.replace('$','').replace('.','').replace(',','')),
                timestamp: Timestamp.now(), adminEmail: user.email
            };
            try {
                const id = document.getElementById('booking-id').value;
                if (id) await updateDoc(getPublicDoc("bookings", id), data);
                else await addDoc(getPublicCollection("bookings"), data);
                window.closeModals();
            } catch (err) { alert(err.message); }
        };

        document.getElementById('product-form').onsubmit = async (e) => {
            e.preventDefault();
            const data = {
                name: document.getElementById('prod-name').value.trim(),
                stock: parseInt(document.getElementById('prod-stock').value),
                salePrice: parseFloat(document.getElementById('prod-suggested-price').textContent.replace('$','')),
                unitCost: parseFloat(document.getElementById('prod-unit-cost').value)
            };
            await addDoc(getPublicCollection("products"), data);
            e.target.reset(); document.getElementById('product-form-container').classList.add('is-hidden');
        };

        window.calculateProductPrices = () => {
            const cost = parseFloat(document.getElementById('prod-batch-cost').value) || 0;
            const qty = parseInt(document.getElementById('prod-batch-qty').value) || 1;
            const unit = cost / qty;
            const sugg = Math.ceil(unit * (1 + (parseInt(document.getElementById('prod-profit-pct').value || 40) / 100)));
            document.getElementById('prod-suggested-price').textContent = `$${sugg}`;
            document.getElementById('prod-unit-cost').value = unit;
        };
        document.getElementById('prod-batch-cost').oninput = window.calculateProductPrices;
        document.getElementById('prod-batch-qty').oninput = window.calculateProductPrices;
        document.getElementById('prod-profit-pct').oninput = window.calculateProductPrices;

        document.getElementById('config-form').onsubmit = async (e) => {
            e.preventDefault();
            const val = parseFloat(document.getElementById('config-court1-price').value);
            try {
                await setDoc(getPublicDoc("app_settings", "prices"), { court1Price: val }, { merge: true });
                appSettings.court1Price = val;
                showMessage("Ajustes de tarifas guardados!"); setTimeout(hideMessage, 1500);
            } catch(e) { alert(e.message); }
        };

        document.getElementById('add-product-btn').onclick = () => document.getElementById('product-form-container').classList.toggle('is-hidden');
        document.getElementById('cancel-product-btn').onclick = () => document.getElementById('product-form-container').classList.add('is-hidden');
        
        document.getElementById('login-form').onsubmit = (e) => { e.preventDefault(); signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value); };
        document.getElementById('logout-btn').onclick = () => signOut(auth);

        function loadCajaData() {
            onSnapshot(query(collection(db, "sales"), orderBy("timestamp", "desc")), (snap) => {
                const list = document.getElementById('caja-daily-list');
                if(!list) return;
                list.innerHTML = ''; let total = 0;
                snap.forEach(d => {
                    const s = d.data(); total += s.total || 0;
                    list.innerHTML += `<div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex justify-between items-center transition-all hover:scale-[1.01]">
                        <div><p class="font-black text-sm uppercase text-slate-800 leading-none mb-2">${s.name} (x${s.qty})</p><p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">${s.day} | ${s.paymentMethod || 'Efectivo'}</p></div>
                        <strong class="text-orange-600 font-black italic text-2xl tracking-tighter">$${(s.total || 0).toLocaleString()}</strong>
                    </div>`;
                });
                document.getElementById('caja-total-combined').textContent = `$${total.toLocaleString()}`;
            });
        }

        window.deleteProduct = async (id) => { if(confirm("¬øBorrar producto de la lista?")) await deleteDoc(getPublicDoc("products", id)); };
        
        function showMessage(msg, isE = false) { const t = document.getElementById('message-text'); if(t) t.textContent = msg; document.getElementById('message-overlay').classList.add('is-open'); }
        function hideMessage() { document.getElementById('message-overlay').classList.remove('is-open'); }
        
        document.getElementById('sale-catalog-filter').oninput = (e) => renderSaleCatalog(e.target.value);

    </script>
</body>
</html>
